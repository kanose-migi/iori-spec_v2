{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://iori-spec.dev/schemas/artifacts/index.schema.json",
  "title": "iori-spec index.json schema",
  "description": "Schema for iori-spec index artifact produced by `iori-spec index` (stable artifact contract).",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "generated_at",
    "spec_roots",
    "documents"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "description": "Artifact schema version (semver-like). Bump on breaking changes.",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+(?:-[A-Za-z0-9.-]+)?$"
    },
    "generated_at": {
      "type": "string",
      "description": "Generation timestamp (RFC 3339 / ISO-8601).",
      "format": "date-time"
    },
    "spec_roots": {
      "type": "array",
      "minItems": 1,
      "description": "Discovery roots and glob filters used for indexing (repo-relative preferred).",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["root"],
        "properties": {
          "root": { "type": "string", "minLength": 1 },
          "include_globs": { "type": "array", "items": { "type": "string", "minLength": 1 } },
          "exclude_globs": { "type": "array", "items": { "type": "string", "minLength": 1 } }
        }
      }
    },
    "tool": {
      "type": "object",
      "description": "Tool identity metadata for diagnostics.",
      "additionalProperties": false,
      "required": ["name", "version"],
      "properties": {
        "name": { "type": "string", "const": "iori-spec" },
        "version": { "type": "string", "minLength": 1 },
        "build": { "type": "string", "minLength": 1 }
      }
    },
    "documents": {
      "type": "array",
      "description": "Discovered spec documents (one entry per file).",
      "minItems": 0,
      "items": { "$ref": "#/definitions/document_entry" }
    },
    "stats": {
      "type": "object",
      "description": "Optional counts for quick diagnostics.",
      "additionalProperties": false,
      "properties": {
        "document_count": { "type": "integer", "minimum": 0 },
        "by_kind": {
          "type": "object",
          "additionalProperties": { "type": "integer", "minimum": 0 }
        }
      }
    },
    "errors": {
      "type": "array",
      "description": "Optional non-fatal indexing errors (e.g., unreadable files).",
      "items": { "$ref": "#/definitions/index_error" }
    }
  },
  "definitions": {
    "document_entry": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "kind",
        "scope",
        "spec_title",
        "path"
      ],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[A-Z][A-Z0-9]*(?:-[A-Z][A-Z0-9]*)*-[0-9]{3}$",
          "description": "Spec ID (e.g., SPEC-SYS-006, REQ-810)."
        },
        "kind": {
          "type": "string",
          "enum": [
            "steering",
            "requirements",
            "architecture",
            "interfaces",
            "data_contracts",
            "tests",
            "reference",
            "dev_tasks",
            "impl_notes"
          ],
          "description": "Spec kind (drives section schema and tooling behavior)."
        },
        "scope": {
          "type": "string",
          "description": "Project scope taxonomy key. Allows dotted subpaths (e.g., tooling.lint.trace).",
          "pattern": "^[a-z][a-z0-9_]*(?:\\.[a-z][a-z0-9_-]*)*$"
        },
        "spec_title": { "type": "string", "minLength": 1, "maxLength": 200 },
        "variant": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_-]*$",
          "description": "Optional variant within kind (project taxonomy)."
        },
        "stability": {
          "type": "string",
          "enum": ["core", "edge"],
          "description": "Stability tier."
        },
        "status": {
          "type": "string",
          "enum": ["draft", "active", "deprecated"],
          "description": "Lifecycle status."
        },
        "path": {
          "type": "string",
          "minLength": 1,
          "description": "Path to the spec file (spec_root-relative preferred)."
        },
        "file": {
          "type": "object",
          "description": "Optional file fingerprinting for caching and diagnostics.",
          "additionalProperties": false,
          "properties": {
            "sha256": { "type": "string", "pattern": "^[a-fA-F0-9]{64}$" },
            "bytes": { "type": "integer", "minimum": 0 },
            "mtime": { "type": "string", "format": "date-time" }
          }
        },
        "front_matter": {
          "type": "object",
          "description": "Optional raw front matter object (normalized).",
          "additionalProperties": true
        },
        "sections": {
          "type": "array",
          "description": "Optional section index (heading structure) if produced by the indexer.",
          "items": { "$ref": "#/definitions/section_entry" }
        },
        "references": {
          "type": "array",
          "description": "Optional extracted references (IDs / links) for traceability tooling.",
          "items": { "$ref": "#/definitions/ref_entry" }
        }
      }
    },
    "section_entry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["section_id", "title"],
      "properties": {
        "section_id": { "type": "string" },
        "title": { "type": "string", "minLength": 1 },
        "level": { "type": "integer", "minimum": 1, "maximum": 6 },
        "start_line": { "type": "integer", "minimum": 1 },
        "end_line": { "type": "integer", "minimum": 1 }
      }
    },
    "ref_entry": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "value"],
      "properties": {
        "type": { "type": "string", "enum": ["id", "url", "path"] },
        "value": { "type": "string", "minLength": 1 },
        "context": { "type": "string" },
        "line": { "type": "integer", "minimum": 1 }
      }
    },
    "index_error": {
      "type": "object",
      "additionalProperties": false,
      "required": ["path", "message"],
      "properties": {
        "path": { "type": "string", "minLength": 1 },
        "message": { "type": "string", "minLength": 1 },
        "code": { "type": "string" },
        "severity": { "type": "string", "enum": ["info", "warn", "error"] }
      }
    }
  }
}
