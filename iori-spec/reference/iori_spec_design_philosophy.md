---
kind: reference
scope: iori-spec
spec_title: "iori-spec Design Philosophy"
status: draft
---

# iori-spec Design Philosophy

## iori-spec の思想

### 背景：いまの LLM コーディングが抱えている2つの課題

LLM にコーディングを任せるとき、多くの現場で次の2つがボトルネックになりがちです。

- **大規模なコードベース全体を前提にした推論を求めると、出力の品質が安定しないこと**  
  小さなファイル単位ならうまく動いても、リポジトリ全体の前提を共有させようとした途端に、設計方針やインターフェースがぶれやすくなります。

- **中小規模のチームや個人開発者にとって、十分なコンテキスト長と呼び出し回数を確保しづらいこと**  
  「常にプロジェクト全体をコンテキストに載せる」前提の運用は、トークン上限や料金プランの制約から現実的でないケースが多くなります。

iori-spec は、この2つの課題を前提にしたうえで、  
**仕様をグラフとして扱うスクリプトベースのツール群**を用いて、  
「**LLM には常に小さな局所だけ渡す**」「**高コンテキスト前提・高額プラン前提にしない**」という方向で、LLM ファーストに設計された開発環境を提供します。


### Brief：2つの方針（この課題にどう向き合うか）

上の2つの課題に対して、iori-spec の思想は次の2つの方針で整理できます。

- 方針1. **大規模なコードベースでも、LLM から見ると常に “小さな局所” だけを扱えばよいようにする**  
  → 必要な REQ / IF / DATA / TEST だけをツール側で切り出し、  
  どんなタスクでも「小さな一貫したコンテキスト」で推論できるようにして、  
  大規模化に伴う品質のばらつきを抑えます。

- 方針2. **高コンテキスト前提にせず、限られたコンテキスト長と呼び出し回数の中で回せるようにする**  
  → 仕様構造とトレース情報を整理し、「本当に必要な断片だけ」を渡す運用を標準化することで、  
  中小規模のチームや個人でも、現実的なコストで LLM 開発を続けられる状態を目指します。

この2つの方針を支える手段として、

- LLM 協調を前提とした SDD（Specification-Driven Development）
- 仕様をグラフとして扱う **スクリプトによるツール群**（例: `impact`, `context`）

を組み合わせます。  
これらのツールは LLM を呼び出さずに仕様グラフを解析できるため、軽量に何度でも実行でき、  
そのうえで **LLM に渡すコンテキストと呼び出し回数を圧縮する役割** を担います。

### 設計品質・構造健全性について

方針1・方針2を機能させる前提として、iori-spec では仕様とシステムの構造を次のような状態に保つことを重視します。

- **高凝集**：モジュールごとに責務がはっきりしていること
- **疎結合**：不必要に他モジュールに依存しないこと
- **関心の分離 (SoC)**：レイヤーや境界ごとに関心が分離されていること
- **非冗長 (DRY)**：同じ意味のことがあちこちに重複しないこと

このような構造になっていると：

- 方針1 に対しては、  
  1つの REQ / IF / DATA / TEST の責務と影響範囲が自然に局所化されるため、  
  スクリプトによるコンテキスト抽出（`impact` / `context` など）が素直に機能します。
- 方針2 に対しては、  
  「本当に必要な断片だけ」を切り出しやすくなるため、  
  限られたコンテキスト長と呼び出し回数でも運用しやすくなります。

逆に言うと、「LLM には常に小さな局所だけ渡す」という運用を前提にすると、  
責務の分割や依存関係の整理が自然と求められ、結果として上記のような構造健全性が維持されやすくなります。

### ツール群の概要

iori-spec のツール群は、スクリプトで実装された小さな CLI コマンドの集合です。  
LLM に直接大規模なコンテキスト処理を任せるのではなく、ツール側で決定的な前処理を行います。

例：

- `impact REQ-101`  
  → REQ-101 に論理的に接続している IF / DATA / TEST / doc をグラフからたどり、「影響を受ける局所」を列挙する。
- `context REQ-101`  
  → 上記の影響範囲から、LLM に渡すための最小限のコンテキストバンドルを生成する。

こうしたツールを挟むことで、

- LLM は常に「小さく一貫した局所コンテキスト」に対してのみ推論すればよくなり、
- ユーザーは「どのファイルを読ませるか」を毎回手作業で選ぶ必要がなくなります。

### iori-spec の世界観：仕様をグラフとして扱う

iori-spec は、仕様を単なるファイルの集まりではなく、**ID 付きノードとグラフ構造**として扱います。

- 仕様は REQ / IF / DATA / TEST / TASK の **ID 付きノードの集合**である
- それらの関係は、主に次のグラフとして表現される
  - `G_trace`：REQ → IF / DATA / TEST の **トレースグラフ**
  - `G_DP`：IF ⇄ DATA の **Data–Process グラフ**
  - `G_doc`：仕様ファイル間の **ドキュメント依存グラフ**

スクリプトで実装されたツール群（`impact`, `context` など）は、このグラフをたどることで：

- あるノード（ID / doc）を起点に、その上下流のノードを機械的に列挙する
- 追加・変更・削除といった操作に対して、影響を受けるノードを洗い出す
- LLM に渡すべき最小限の局所コンテキストを、決定的な手続きとして切り出す

といった処理を行います。
